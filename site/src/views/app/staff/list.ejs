<%- contentFor('body') %>
<!-- Content Header (Page header) -->
<section class="content-header">
    <h1>
        <i class="fa fa-users"></i> Staff
    </h1>
    <ol class="breadcrumb">
        <li><a href="/app">Home</a></li>
        <li class="active"><i class="fa fa-users"></i> Staff</li>
    </ol>
</section>

<!-- Main content -->
<section class="content">

    <div class="box">
        <div class="box-header">
            <h3 class="box-title">Lista de Staff</h3>
        </div>
        <!-- /.box-header -->

        <div class="box-body" v-if="staffs.loading && !staffs.loaded">
            <div class="alert alert-info">
                Carregando...
            </div>
        </div>

        <div class="box-body" v-if="staffs.loaded && !staffs.list.length">
            <div class="alert alert-warning">
                Nenhum registro encontrado
            </div>
        </div>

        <div class="box-body table-responsive no-padding" v-if="staffs.loaded && staffs.list.length">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th width="80">Avatar</th>
                        <th width="300">Staff</th>
                        <th width="150">Cargo</th>
                        <th width="150">Online</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="staff in staffs.list">
                        <td>
                            <img :src="staff.avatar" :alt="staff.nick" class="img-rounded" style="max-width: 32px;">
                        </td>
                        <td>
                            <a :href="'/app/staff/' + staff.member_id">
                                {{ staff.nick }}
                            </a>
                        </td>
                        <td>
                            <span
                                class="role pull-left"
                                :style="`
                                    border-color: ${staff.roles[0].color};
                                    margin: 0 8px 8px 0;
                                    padding: .2em .6em .3em;
                                `"
                            >
                                {{ staff.roles[0].name }}
                            </span>
                        </td>
                        <td>
                            <span class="label label-success" v-if="staff.online">Sim</span>
                            <span class="label label-danger" v-if="!staff.online">NÃ£o</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- /.box-body -->

        <div class="overlay" v-if="staffs.loading">
            <i class="fa fa-refresh fa-spin"></i>
        </div>
    </div>

</section>
<!-- /.content -->

<%- contentFor('scripts') %>
<script>
    mixins.push({
        data: {
            staffs: {
                loading: true,
                loaded: false,
                error: false,
                messages: [],
                list: [],
            },
        },
        methods: {
            init: function () {
                App.getStaffs();
            },
            getStaffs: async () => {
                try {
                    function callback(data) {
                        if (typeof data.error !== 'undefined') App.staffs.error = data.error;
                        if (typeof data.messages !== 'undefined') App.staffs.messages = data.messages;
                        if (typeof data.content !== 'undefined') {
                            if (typeof data.content.staff !== 'undefined') App.staffs.list = data.content.staff;
                        }

                        App.staffs.loading = false;
                        App.staffs.loaded = true;
                    }

                    App.staffs.loading = true;

                    const { data } = await axios.get('/api/staff')

                    callback(data);
                } catch ({ response }) {
                    callback(response.data);
                }
            },
        },
    });
</script>